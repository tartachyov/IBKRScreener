"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var IbkrEvents_1 = require("../events/IbkrEvents");
var IBKREVENTS_const_1 = require("../events/IBKREVENTS.const");
var IBKRConnection_1 = __importDefault(require("./IBKRConnection"));
/**
 * Async function for getting IBKR @connected event
 */
exports.onConnected = function () {
    var appEvents = IbkrEvents_1.IbkrEvents.Instance;
    var ibkr = IBKRConnection_1.default.Instance;
    return new Promise(function (resolve) {
        if (ibkr.status === IBKREVENTS_const_1.IBKREVENTS.CONNECTED) {
            return resolve(true);
        }
        var handleConnected = function () {
            removeListners();
            resolve(true);
        };
        var handleDisconnect = function () {
            removeListners();
            resolve(false);
        };
        var removeListners = function () {
            appEvents.off(IBKREVENTS_const_1.IBKREVENTS.CONNECTED, handleConnected);
            appEvents.off(IBKREVENTS_const_1.IBKREVENTS.DISCONNECTED, handleDisconnect);
        };
        appEvents.on(IBKREVENTS_const_1.IBKREVENTS.CONNECTED, handleConnected);
        appEvents.on(IBKREVENTS_const_1.IBKREVENTS.DISCONNECTED, handleDisconnect);
        // ping
        appEvents.emit(IBKREVENTS_const_1.IBKREVENTS.PING, {});
    });
};
//# sourceMappingURL=connection.utilities.js.map